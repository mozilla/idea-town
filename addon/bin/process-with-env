#!/usr/bin/env node

const fs = require('fs-extra');
const manifestBase = require('../manifest-base.json');
const manifestFilename = __dirname + '/../manifest.json';
let backgroundBaseFile = fs.readFileSync('../background-base.js');

fs.writeJson(manifestFilename, Object.assign(manifestBase, {
  permissions: process.env['ENVIRONMENT_URL']
})).then(() => {
  backgroundBaseFile.replace('$ENVIRONMENT_TITLE', process.env['ENVIRONMENT_TITLE']);
  backgroundBaseFile.replace('$ENVIRONMENT_URL', process.env['ENVIRONMENT_URL']);
  fs.writeFile('../background.js', backgroundBaseFile).then(() => {
    console.log('it is complete');
    process.exit();
  });
}).catch(err => {
  console.error(err)
});
